'use client'

import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react'
import { logError, logWarn } from '@/lib/client-logger'

export type Locale = 'ca' | 'es' | 'en'

interface I18nContextType {
  locale: Locale
  setLocale: (locale: Locale) => void
  t: (key: string, params?: Record<string, string | number>) => string
  translateText: (text: string, targetLocale?: Locale) => Promise<string>
}

const I18nContext = createContext<I18nContextType | undefined>(undefined)

const translations: Record<Locale, Record<string, string>> = {
  ca: {
    'common.appName': 'Xarxa Anglesola',
    'common.loading': 'Carregant...',
    'common.error': 'Error',
    'common.save': 'Desar',
    'common.cancel': 'Cancel¬∑lar',
    'common.delete': 'Eliminar',
    'common.edit': 'Editar',
    'common.send': 'Enviar',
    'common.close': 'Tancar',
    'common.next': 'Seg√ºent',
    'common.back': 'Tornar',
    'common.translate': 'Traduir',
    'auth.title': 'Xarxa Anglesola',
    'auth.subtitle': 'Intercanvi de Productes',
    'auth.nickname': 'Usuari',
    'auth.nicknamePlaceholder': 'Introdueix el teu usuari',
    'auth.password': 'Contrasenya',
    'auth.passwordPlaceholder': 'Introdueix la teva contrasenya',
    'auth.confirmPassword': 'Confirma la contrasenya',
    'auth.confirmPasswordPlaceholder': 'Introdueix de nou la contrasenya',
    'auth.email': 'Email',
    'auth.emailPlaceholder': 'Introdueix el teu email',
    'auth.newUser': 'S√≥c un usuari nou',
    'auth.register': 'Registrar-se',
    'auth.nicknameRequired': 'L\'usuari √©s obligatori',
    'auth.passwordRequired': 'La contrasenya √©s obligat√≤ria',
    'auth.confirmPasswordRequired': 'La confirmaci√≥ de contrasenya √©s obligat√≤ria',
    'auth.emailRequired': 'L\'email √©s obligatori',
    'auth.emailInvalid': 'Format d\'email inv√†lid',
    'auth.passwordsDoNotMatch': 'Les contrasenyes no coincideixen',
    'auth.passwordMinLength': 'La contrasenya ha de tenir almenys 6 car√†cters',
    'auth.nicknameMinLength': 'L\'usuari ha de tenir almenys 3 car√†cters',
    'auth.error': 'Error al iniciar sessi√≥',
    'auth.connectionError': 'Error de connexi√≥. Torna-ho a intentar.',
    'auth.enter': 'Entrar',
    'auth.or': 'o',
    'auth.continueWithGoogle': 'Continua amb Google',
    'auth.showPassword': 'Mostrar contrasenya',
    'auth.hidePassword': 'Ocultar contrasenya',
    'auth.forgotPassword': 'He oblidat la contrasenya',
    'auth.forgotPasswordTitle': 'Recuperar contrasenya',
    'auth.forgotPasswordDescription': 'Introdueix el teu email i t\'enviarem un enlla√ß per restablir la teva contrasenya.',
    'auth.forgotPasswordSuccess': 'Si l\'email existeix, s\'ha enviat un enlla√ß de recuperaci√≥ al teu correu.',
    'auth.forgotPasswordError': 'Error sol¬∑licitant la recuperaci√≥ de contrasenya',
    'auth.sendResetLink': 'Enviar enlla√ß',
    'auth.resetPasswordTitle': 'Restablir contrasenya',
    'auth.resetPasswordDescription': 'Introdueix la teva nova contrasenya',
    'auth.newPassword': 'Nova contrasenya',
    'auth.resetPassword': 'Restablir contrasenya',
    'auth.resetPasswordSuccess': 'Contrasenya restablida correctament. Redirigint...',
    'auth.resetPasswordError': 'Error restablint la contrasenya',
    'auth.invalidToken': 'Token inv√†lid o expirat. Sol¬∑licita un nou enlla√ß de recuperaci√≥.',
    'auth.backToLogin': 'Tornar al login',
    'auth.redirectingToLogin': 'Redirigint al login...',
    'auth.accountNotLinked': 'Has desvinculat aquest compte de Google. Inicia sessi√≥ amb usuari i contrasenya.',
    'auth.acceptTerms': 'Accepto la',
    'auth.privacyPolicy': 'Pol√≠tica de Privacitat',
    'auth.and': 'i els',
    'auth.termsConditions': 'Termes i Condicions',
    'auth.mustAccept': 'Has d\'acceptar la pol√≠tica de privacitat i els termes i condicions per registrar-te',
    'nav.products': 'Productes',
    'nav.favorites': 'Preferits',
    'nav.myProducts': 'Els meus productes',
    'nav.chat': 'Xat General',
    'nav.notifications': 'Alertes',
    'nav.noNotifications': 'No hi ha alertes noves',
    'nav.hello': 'Hola, {nickname}!',
    'nav.logout': 'Sortir',
    'nav.settings': 'Configuraci√≥',
    'nav.openMenu': 'Obrir men√∫',
    'nav.closeMenu': 'Tancar men√∫',
    'info.title': 'Com funciona la Xarxa?',
    'info.intro': 'La Xarxa Anglesola √©s un espai de trobada de la comunitat de l\'escola per compartir recursos i donar-nos un cop de m√†. Descobreix tot el que hi pots fer:',
    'info.productsTitle': 'üì¶ Veure productes',
    'info.productsDesc': 'Fes una ullada al que la gent posa a disposici√≥. Bicis, llibres, eines... el que necessitis!',
    'info.favoritesTitle': '‚ù§Ô∏è Guardar als preferits',
    'info.favoritesDesc': 'Si alguna cosa et fa gr√†cia, afegeix-la als preferits per trobar-la despr√©s sense perdre-la.',
    'info.myProductsTitle': '‚ú® Publicar els teus',
    'info.myProductsDesc': 'Tens alguna cosa que no fas servir? Publica-la!',
    'info.reserveTitle': 'üìå Reservar',
    'info.reserveDesc': 'Hi ha alguna cosa que t\'hagi cridat l\'atenci√≥? Reserva-la i contacta amb qui la publica per quedar.',
    'info.reserveMoreDetails': 'M√©s detalls',
    'info.reserveDetailTitle': 'Tipus de reserves',
    'info.reserveDetailIntro': 'Hi ha dues maneres de reservar un producte a la Xarxa:',
    'info.reserveType1Title': 'Reserva com a propietari del producte',
    'info.reserveType1Desc': 'Prem el bot√≥ reservar, aix√≠ quedar√† inhabilitada per a d\'altres reserves i en el cas que sigui un producte que nom√©s sigui per a pr√©stecs, podr√†s canviar-ne l\'estat quan sigui necessari.',
    'info.reserveType1DescBefore': 'Prem el bot√≥ ',
    'info.reserveType1DescAfter': ', aix√≠ quedar√† inhabilitada per a d\'altres reserves i en el cas que sigui un producte que nom√©s sigui per a pr√©stecs, podr√†s canviar-ne l\'estat quan sigui necessari.',
    'info.reserveType2Title': 'Reserva per DM',
    'info.reserveType2Desc': 'Si obres el xat privat d\'un producte, el reserves autom√†ticament (el primer que obre el xat √©s qui reserva). Si veus que la fotografia t√© un marc groc, significa que l\'has reservat tu, si nom√©s t√© la icona en groc, l\'ha reservat una altra persona.',
    'info.chatTitle': 'üí¨ Xatejar',
    'info.chatDesc': 'Parla al xat general o en privat amb qui publica un producte. Ideal per coordinar lliuraments.',
    'info.notificationsTitle': 'üîî Notificacions',
    'info.notificationsDesc': 'Activa i personalitza les alertes a la campana per saber quan et reserven algun producte, t\'escriuen o hi ha algun canvi als teus preferits.',
    'info.settingsTitle': '‚öôÔ∏è Configuraci√≥',
    'info.settingsDesc': 'Des d\'aqu√≠ gestiones el teu compte, les prefer√®ncies de notificacions i les teves dades.',
    'config.title': 'Configuraci√≥',
    'config.account': 'Compte',
    'config.unlinkGoogle': 'Desvincula Google',
    'config.unlinkGoogleConfirm': 'Vols desvincular el compte de Google? A partir d\'ara haur√†s d\'iniciar sessi√≥ amb usuari i contrasenya.',
    'config.unlinkGoogleSuccess': 'Google desvinculat.',
    'config.unlinkGoogleError': 'Error desvinculant Google.',
    'config.changeGoogle': 'Canvia el compte de Google',
    'config.changeGoogleConfirm': 'Es far√† logout i s\'obrir√† Google per triar un altre compte. Vols continuar?',
    'config.changeGoogleError': 'Error en canviar el compte de Google.',
    'config.noGoogleLinked': 'No tens cap compte de Google vinculat.',
    'config.googleLinked': 'Google vinculat',
    'config.loading': 'Carregant...',
    'config.version': 'Versi√≥',
    'products.title': 'Productes',
    'products.newProduct': '+ Nou Producte',
    'products.noProducts': 'No hi ha productes disponibles',
    'products.publishedBy': 'Publicat per',
    'products.publishedOn': 'Publicat el',
    'products.description': 'Descripci√≥',
    'products.contact': 'Contactar',
    'products.reserved': 'Reservat',
    'products.reservedByYou': "L'has reservat tu",
    'products.notReserved': 'No reservat',
    'products.unreserved': 'Desreservar',
    'products.favoritesCount': '{count} preferits',
    'products.reserve': 'Reservar',
    'products.prestec': 'Pr√©stec',
    'products.prestecTitle': 'Marcar com a pr√©stec',
    'products.unprestecTitle': 'Desmarcar com a pr√©stec',
    'products.deleteConfirm': 'Est√†s segur que vols eliminar aquest producte?',
    'products.addToFavorites': 'Afegir a preferits',
    'products.removeFromFavorites': 'Eliminar de preferits',
    'products.filters.name': 'Nom del producte',
    'products.filters.user': 'Usuari',
    'products.filters.dateFrom': 'Data des de',
    'products.filters.dateTo': 'Data fins a',
    'products.filters.namePlaceholder': 'Cerca per nom...',
    'products.filters.userPlaceholder': 'Cerca per usuari...',
    'products.filters.clearFilters': 'Esborrar filtres',
    'products.filters.title': 'Filtres',
    'products.showing': 'Mostrant {filtered} de {total} productes',
    'products.noProductsPublished': 'Encara no hi ha productes publicats.',
    'products.beFirst': 'Sigues el primer a publicar un producte!',
    'products.noResults': "No s'han trobat productes amb els filtres seleccionats.",
    'products.deleteProduct': 'Eliminar producte',
    'products.seeMoreDetails': 'Veure m√©s detalls',
    'products.reserveTitle': 'Reservar',
    'products.unreserveTitle': 'Desreservar',
    'products.switchToGridView': 'Canviar a vista grid',
    'products.switchToListView': 'Canviar a vista llista',
    'products.refresh': 'Actualitzar',
    'favorites.title': 'Els meus preferits',
    'favorites.noFavorites': 'Encara no tens cap producte als preferits.',
    'favorites.explore': 'Explora productes ‚Üí',
    'myProducts.title': 'Els meus productes',
    'myProducts.noProducts': 'Encara no has publicat cap producte.',
    'myProducts.publishFirst': 'Publica el teu primer producte ‚Üí',
    'newProduct.title': 'Nou Producte',
    'newProduct.name': 'Nom del producte *',
    'newProduct.namePlaceholder': 'Introdueix el nom del producte',
    'newProduct.description': 'Descripci√≥',
    'newProduct.descriptionPlaceholder': 'Introdueix una descripci√≥ del producte',
    'newProduct.images': 'Imatges (m√†xim 4) *',
    'newProduct.maxImages': 'M√†xim 4 imatges',
    'newProduct.upload': 'Pujar imatge',
    'newProduct.create': 'Publicar Producte',
    'newProduct.publishing': 'Publicant...',
    'newProduct.nameRequired': 'El nom del producte √©s obligatori',
    'newProduct.addImage': 'Afegeix almenys una imatge',
    'newProduct.userNotAuth': 'Usuari no autenticat',
    'newProduct.createError': 'Error al crear el producte',
    'newProduct.connectionError': 'Error de connexi√≥. Torna-ho a intentar.',
    'productDetail.backToProducts': '‚Üê Tornar als productes',
    'productDetail.loading': 'Carregant...',
    'productDetail.notFound': 'Producte no trobat',
    'productDetail.noImage': 'Sense imatge',
    'productDetail.reserved': 'Reservat',
    'productDetail.prestec': 'Pr√©stec',
    'productDetail.description': 'Descripci√≥',
    'productDetail.publishedBy': 'Publicat per',
    'productDetail.publishedOn': 'Publicat el',
    'productDetail.delete': 'Eliminar',
    'productDetail.contact': 'Contactar',
    'chat.general': 'üí¨ Xat General',
    'chat.privateWith': 'Xat amb {nickname}',
    'chat.noMessages': 'No hi ha missatges encara. Sigues el primer a escriure!',
    'chat.writeMessage': 'Escriu un missatge...',
    'chat.writePrivateMessage': 'Escriu un missatge privat...',
    'chat.connecting': 'Connectant...',
    'chat.onlineUsers': 'Usuaris en l√≠nia',
    'chat.noOnlineUsers': 'No hi ha altres usuaris en l√≠nia',
    'chat.closeChat': 'Tancar xat',
    'chat.startPrivateChat': 'Xat privat amb {nickname}',
    'chat.send': 'Enviar',
    'chat.disabledProduction': '‚ö†Ô∏è El xat en temps real no est√† disponible a producci√≥. Socket.io requereix configuraci√≥ addicional.',
    'chat.today': 'Avui',
    'chat.yesterday': 'Ahir',
    'chat.dateSeparator': '{date}',
    'notifications.newMessage': 'Nou missatge',
    'notifications.newPrivateMessage': 'Nou missatge privat',
    'notifications.productReserved': 'Producte reservat',
    'notifications.productReservedMessage': '{nickname} ha reservat el teu producte: {productName}',
    'notifications.productUnreserved': 'Producte desreservat',
    'notifications.productUnreservedMessage': '{nickname} ha desreservat el teu producte: {productName}',
    'notifications.productUnreservedFromFavorites': 'Producte desreservat',
    'notifications.productUnreservedFromFavoritesMessage': '{nickname} ha desreservat un producte dels teus preferits: {productName}',
    'notifications.productDeletedFromFavorites': 'Producte eliminat',
    'notifications.productDeletedFromFavoritesMessage': '{nickname} ha eliminat un producte dels teus preferits: {productName}',
    'notifications.productAddedToFavorites': 'Producte afegit als preferits',
    'notifications.productAddedToFavoritesMessage': '{nickname} ha afegit el teu producte als preferits: {productName}',
    'notifications.sessionTerminated': 'Sessi√≥ tancada',
    'notifications.sessionTerminatedMessage': 'Una nova sessi√≥ s\'ha obert des d\'un altre dispositiu.',
    'notifications.view': 'Veure',
    'notifications.enableNotifications': 'Activar notificacions',
    'notifications.notificationsEnabled': 'Notificacions activades',
    'notifications.notificationsEnabledMessage': 'Ara rebr√†s notificacions del navegador.',
    'notifications.notificationsDisabled': 'Notificacions desactivades',
    'notifications.notificationsDisabledMessage': 'Has denegat els permisos de notificaci√≥. Pots activar-les des de la configuraci√≥ del navegador.',
    'notifications.enabled': 'Notificacions activades',
    'notifications.disableNotifications': 'Desactivar notificacions',
    'notifications.disableInstructions': 'Desactivar notificacions',
    'notifications.disableInstructionsMessage': 'Per desactivar les notificacions, ves a la configuraci√≥ del teu navegador i bloqueja els permisos de notificaci√≥ per a aquest lloc web.',
    'notifications.preferencesTitle': 'Prefer√®ncies de notificacions',
    'notifications.receiveAll': 'Rebre totes les notificacions',
    'notifications.allowedUsersLabel': 'Usuaris permesos',
    'notifications.allowedUsersHint': 'Nicknames separats per comes (ex: xavi, maria)',
    'notifications.allowedProductsLabel': 'Tipus de producte',
    'notifications.allowedProductsHint': 'Paraules clau separades per comes (ex: bici, taula)',
    'notifications.savePreferences': 'Desar prefer√®ncies',
    'notifications.preferencesSaved': 'Prefer√®ncies desades',
    'notifications.preferencesError': 'No s\'han pogut desar les prefer√®ncies',
    'notifications.preferencesLoading': 'Carregant prefer√®ncies...',
    'config.gdpr.title': 'Protecci√≥ de dades (GDPR)',
    'config.gdpr.exportDescription': 'Desc√†rrega una c√≤pia de totes les teves dades personals en format JSON.',
    'config.gdpr.deleteDescription': 'Elimina permanentment el teu compte i totes les teves dades. Aquesta acci√≥ no es pot desfer.',
    'legal.privacy.title': 'Pol√≠tica de Privacitat',
    'legal.privacy.lastUpdated': '√öltima actualitzaci√≥',
    'legal.privacy.section1.title': '1. Introducci√≥',
    'legal.privacy.section1.content': 'Aquesta Pol√≠tica de Privacitat descriu com recopilem, utilitzem i protegim la teva informaci√≥ personal quan utilitzes la plataforma Xarxa Anglesola. Ens comprometem a protegir la teva privacitat i complir amb la normativa de protecci√≥ de dades aplicable.',
    'legal.privacy.section2.title': '2. Dades que recopilem',
    'legal.privacy.section2.item1': 'Dades d\'identificaci√≥: nickname, email, nom (opcional)',
    'legal.privacy.section2.item2': 'Dades d\'autenticaci√≥: contrasenya encriptada, tokens de sessi√≥',
    'legal.privacy.section2.item3': 'Contingut generat: productes publicats, missatges de xat, llista de preferits',
    'legal.privacy.section2.item4': 'Dades de comportament: prefer√®ncies de notificaci√≥, activitat a la plataforma',
    'legal.privacy.section2.item5': 'Dades t√®cniques: adre√ßa IP, cookies, informaci√≥ del dispositiu',
    'legal.privacy.section3.title': '3. Finalitat del tractament',
    'legal.privacy.section3.content': 'Utilitzem les teves dades per: proporcionar i millorar els nostres serveis, gestionar el teu compte, facilitar la comunicaci√≥ entre usuaris, enviar notificacions rellevants, garantir la seguretat de la plataforma i complir amb obligacions legals.',
    'legal.privacy.section4.title': '4. Base legal',
    'legal.privacy.section4.content': 'El tractament de les teves dades es basa en: el teu consentiment, l\'execuci√≥ d\'un contracte (prestaci√≥ del servei), l\'inter√®s leg√≠tim (seguretat i millora del servei) i el compliment d\'obligacions legals.',
    'legal.privacy.section5.title': '5. Els teus drets',
    'legal.privacy.section5.content': 'D\'acord amb el Reglament General de Protecci√≥ de Dades (RGPD), tens dret a:',
    'legal.privacy.section5.right1': 'Acc√©s: obtenir una c√≤pia de les teves dades personals',
    'legal.privacy.section5.right2': 'Rectificaci√≥: corregir dades inexactes o incompletes',
    'legal.privacy.section5.right3': 'Supressi√≥: sol¬∑licitar l\'eliminaci√≥ de les teves dades',
    'legal.privacy.section5.right4': 'Portabilitat: rebre les teves dades en un format estructurat',
    'legal.privacy.section5.right5': 'Oposici√≥: oposar-te al tractament de les teves dades en determinades circumst√†ncies',
    'legal.privacy.section6.title': '6. Retenci√≥ de dades',
    'legal.privacy.section6.content': 'Conservem les teves dades mentre el teu compte estigui actiu i durant el per√≠ode necessari per complir amb obligacions legals. Pots eliminar el teu compte en qualsevol moment des de la configuraci√≥.',
    'legal.privacy.section7.title': '7. Seguretat',
    'legal.privacy.section7.content': 'Implementem mesures de seguretat t√®cniques i organitzatives per protegir les teves dades contra acc√©s no autoritzat, p√®rdua o destrucci√≥. Les contrasenyes s\'emmagatzemen encriptades i utilitzem connexions segures (HTTPS).',
    'legal.privacy.section8.title': '8. Contacte',
    'legal.privacy.section8.content': 'Per exercir els teus drets o fer consultes sobre privacitat, pots contactar-nos a trav√©s de la configuraci√≥ del teu compte o utilitzant les funcionalitats de gesti√≥ de dades disponibles a la plataforma.',
    'legal.terms.title': 'Termes i Condicions',
    'legal.terms.lastUpdated': '√öltima actualitzaci√≥',
    'legal.terms.section1.title': '1. Acceptaci√≥ dels termes',
    'legal.terms.section1.content': 'En utilitzar la plataforma Xarxa Anglesola, acceptes aquests Termes i Condicions. Si no est√†s d\'acord, no utilitzis el servei.',
    'legal.terms.section2.title': '2. √ös del servei',
    'legal.terms.section2.content': 'Et compromets a utilitzar la plataforma de manera l√≠cita i respectuosa. No pots utilitzar el servei per activitats il¬∑legals, fraudulentes o que violin drets de tercers.',
    'legal.terms.section3.title': '3. Contingut de l\'usuari',
    'legal.terms.section3.content': 'Ets responsable del contingut que publiques (productes, missatges, imatges). Ens reservem el dret de moderar i eliminar contingut que considerem inadequat, ofensiu o que violi aquests termes.',
    'legal.terms.section4.title': '4. Propietat intel¬∑lectual',
    'legal.terms.section4.content': 'Els usuaris conserven els drets sobre el contingut que publiquen. En publicar contingut, ens atorgues una llic√®ncia per utilitzar-lo dins de la plataforma per a la prestaci√≥ del servei.',
    'legal.terms.section5.title': '5. Limitaci√≥ de responsabilitat',
    'legal.terms.section5.content': 'La plataforma es proporciona \'tal com est√†\'. No ens responsabilitzem de danys directes, indirectes o conseq√ºencials derivats de l\'√∫s del servei. Els intercanvis entre usuaris s√≥n responsabilitat dels usuaris.',
    'legal.terms.section6.title': '6. Modificacions',
    'legal.terms.section6.content': 'Ens reservem el dret de modificar aquests termes en qualsevol moment. Les modificacions entrar√†n en vigor quan es publiquin a la plataforma. L\'√∫s continuat del servei despr√©s de les modificacions implica l\'acceptaci√≥ dels nous termes.',
    'legal.terms.section7.title': '7. Resoluci√≥ de conflictes',
    'legal.terms.section7.content': 'Qualsevol disputa relacionada amb l\'√∫s de la plataforma es regir√† per la legislaci√≥ espanyola i catalana. Els usuaris es comprometen a intentar resoldre els conflictes de manera amistosa abans de rec√≥rrer a accions legals.',
    'legal.cookies.message': 'Aquest lloc web utilitza cookies per millorar l\'experi√®ncia d\'usuari i proporcionar funcionalitats essencials.',
    'legal.cookies.learnMore': 'M√©s informaci√≥',
    'legal.cookies.accept': 'Acceptar',
    'legal.cookies.reject': 'Rebutjar',
    'legal.gdpr.exportData': 'Exportar dades',
    'legal.gdpr.deleteAccount': 'Eliminar compte',
    'legal.gdpr.exportSuccess': 'Les teves dades s\'han exportat correctament',
    'legal.gdpr.exportError': 'Error en exportar les dades',
    'legal.gdpr.deleteConfirm': 'Est√†s segur que vols eliminar el teu compte? Aquesta acci√≥ no es pot desfer.',
    'legal.gdpr.deleteSuccess': 'El teu compte s\'ha eliminat correctament',
    'legal.gdpr.deleteError': 'Error en eliminar el compte',
  },
  es: {
    'common.appName': 'Xarxa Anglesola',
    'common.loading': 'Cargando...',
    'common.error': 'Error',
    'common.save': 'Guardar',
    'common.cancel': 'Cancelar',
    'common.delete': 'Eliminar',
    'common.edit': 'Editar',
    'common.send': 'Enviar',
    'common.close': 'Cerrar',
    'common.next': 'Siguiente',
    'common.back': 'Volver',
    'common.translate': 'Traducir',
    'auth.title': 'Xarxa Anglesola',
    'auth.subtitle': 'Intercambio de Productos',
    'auth.nickname': 'Usuario',
    'auth.nicknamePlaceholder': 'Introduce tu usuario',
    'auth.password': 'Contrase√±a',
    'auth.passwordPlaceholder': 'Introduce tu contrase√±a',
    'auth.confirmPassword': 'Confirma la contrase√±a',
    'auth.confirmPasswordPlaceholder': 'Introduce de nuevo la contrase√±a',
    'auth.email': 'Email',
    'auth.emailPlaceholder': 'Introduce tu email',
    'auth.newUser': 'Soy un usuario nuevo',
    'auth.register': 'Registrarse',
    'auth.nicknameRequired': 'El usuario es obligatorio',
    'auth.passwordRequired': 'La contrase√±a es obligatoria',
    'auth.confirmPasswordRequired': 'La confirmaci√≥n de contrase√±a es obligatoria',
    'auth.emailRequired': 'El email es obligatorio',
    'auth.emailInvalid': 'Formato de email inv√°lido',
    'auth.passwordsDoNotMatch': 'Las contrase√±as no coinciden',
    'auth.passwordMinLength': 'La contrase√±a debe tener al menos 6 caracteres',
    'auth.nicknameMinLength': 'El usuario debe tener al menos 3 caracteres',
    'auth.error': 'Error al iniciar sesi√≥n',
    'auth.connectionError': 'Error de conexi√≥n. Vuelve a intentarlo.',
    'auth.enter': 'Entrar',
    'auth.or': 'o',
    'auth.continueWithGoogle': 'Continuar con Google',
    'auth.showPassword': 'Mostrar contrase√±a',
    'auth.hidePassword': 'Ocultar contrase√±a',
    'auth.forgotPassword': 'He olvidado la contrase√±a',
    'auth.forgotPasswordTitle': 'Recuperar contrase√±a',
    'auth.forgotPasswordDescription': 'Introduce tu email y te enviaremos un enlace para restablecer tu contrase√±a.',
    'auth.forgotPasswordSuccess': 'Si el email existe, se ha enviado un enlace de recuperaci√≥n a tu correo.',
    'auth.forgotPasswordError': 'Error solicitando la recuperaci√≥n de contrase√±a',
    'auth.sendResetLink': 'Enviar enlace',
    'auth.resetPasswordTitle': 'Restablecer contrase√±a',
    'auth.resetPasswordDescription': 'Introduce tu nueva contrase√±a',
    'auth.newPassword': 'Nueva contrase√±a',
    'auth.resetPassword': 'Restablecer contrase√±a',
    'auth.resetPasswordSuccess': 'Contrase√±a restablecida correctamente. Redirigiendo...',
    'auth.resetPasswordError': 'Error restableciendo la contrase√±a',
    'auth.invalidToken': 'Token inv√°lido o expirado. Solicita un nuevo enlace de recuperaci√≥n.',
    'auth.backToLogin': 'Volver al login',
    'auth.redirectingToLogin': 'Redirigiendo al login...',
    'auth.accountNotLinked': 'Has desvinculado esta cuenta de Google. Inicia sesi√≥n con usuario y contrase√±a.',
    'auth.acceptTerms': 'Acepto la',
    'auth.privacyPolicy': 'Pol√≠tica de Privacidad',
    'auth.and': 'y los',
    'auth.termsConditions': 'T√©rminos y Condiciones',
    'auth.mustAccept': 'Debes aceptar la pol√≠tica de privacidad y los t√©rminos y condiciones para registrarte',
    'nav.products': 'Productos',
    'nav.favorites': 'Favoritos',
    'nav.myProducts': 'Mis productos',
    'nav.chat': 'Chat General',
    'nav.notifications': 'Alertas',
    'nav.noNotifications': 'No hay alertas nuevas',
    'nav.hello': '¬°Hola, {nickname}!',
    'nav.logout': 'Salir',
    'nav.settings': 'Configuraci√≥n',
    'nav.openMenu': 'Abrir men√∫',
    'nav.closeMenu': 'Cerrar men√∫',
    'info.title': '¬øC√≥mo funciona la Xarxa?',
    'info.intro': 'La Xarxa Anglesola es un espacio para compartir y pedir cosas en pr√©stamo entre padres y madres del colegio Anglesola. Aqu√≠ tienes todo lo que puedes hacer:',
    'info.productsTitle': 'üì¶ Ver productos',
    'info.productsDesc': 'Echa un vistazo a lo que la gente pone a disposici√≥n. Bicis, libros, herramientas... ¬°lo que necesites!',
    'info.favoritesTitle': '‚ù§Ô∏è Guardar en favoritos',
    'info.favoritesDesc': '¬øAlgo te hace gracia? A√±√°delo a favoritos para encontrarlo despu√©s sin perderlo.',
    'info.myProductsTitle': '‚ú® Publicar los tuyos',
    'info.myProductsDesc': '¬øTienes algo que no usas? ¬°Publ√≠calo!',
    'info.reserveTitle': 'üìå Reservar',
    'info.reserveDesc': '¬øHay algo que te haya llamado la atenci√≥n? Res√©rvalo y contacta con quien lo public√≥ para quedar.',
    'info.reserveMoreDetails': 'M√°s detalles',
    'info.reserveDetailTitle': 'Tipos de reserva',
    'info.reserveDetailIntro': 'Hay dos formas de reservar un producto en la Red:',
    'info.reserveType1Title': 'Reserva como propietario del producto',
    'info.reserveType1Desc': 'Pulsa el bot√≥n reservar, as√≠ quedar√° inhabilitado para otras reservas y en el caso de que sea un producto solo para pr√©stamos, podr√°s cambiar su estado cuando sea necesario.',
    'info.reserveType1DescBefore': 'Pulsa el bot√≥n ',
    'info.reserveType1DescAfter': ', as√≠ quedar√° inhabilitado para otras reservas y en el caso de que sea un producto solo para pr√©stamos, podr√°s cambiar su estado cuando sea necesario.',
    'info.reserveType2Title': 'Reserva por DM',
    'info.reserveType2Desc': 'Si abres el chat privado de un producto, lo reservas autom√°ticamente (el primero que abre el chat es quien reserva). Si ves que la fotograf√≠a tiene un marco amarillo, significa que lo has reservado t√∫; si solo tiene el icono en amarillo, lo ha reservado otra persona.',
    'info.chatTitle': 'üí¨ Chatear',
    'info.chatDesc': 'Habla en el chat general o en privado con quien publica un producto. Ideal para coordinar entregas.',
    'info.notificationsTitle': 'üîî Notificaciones',
    'info.notificationsDesc': 'Activa las alertas en la campana para saber cuando te reservan alg√∫n producto, te escriben o hay alg√∫n cambio en tus favoritos.',
    'info.settingsTitle': '‚öôÔ∏è Configuraci√≥n',
    'info.settingsDesc': 'Desde aqu√≠ gestionas tu cuenta, las preferencias de notificaciones y tus datos.',
    'config.title': 'Configuraci√≥n',
    'config.account': 'Cuenta',
    'config.unlinkGoogle': 'Desvincular Google',
    'config.unlinkGoogleConfirm': '¬øQuieres desvincular la cuenta de Google? Se cerrar√° sesi√≥n al instante. Para volver a entrar, usa el formulario (registro o login) o Continuar con Google.',
    'config.unlinkGoogleSuccess': 'Google desvinculado.',
    'config.unlinkGoogleError': 'Error al desvincular Google.',
    'config.changeGoogle': 'Cambiar cuenta de Google',
    'config.changeGoogleConfirm': 'Se cerrar√° sesi√≥n y se abrir√° Google para elegir otra cuenta. ¬øContinuar?',
    'config.changeGoogleError': 'Error al cambiar la cuenta de Google.',
    'config.noGoogleLinked': 'No tienes ninguna cuenta de Google vinculada.',
    'config.googleLinked': 'Google vinculado',
    'config.loading': 'Cargando...',
    'products.title': 'Productos',
    'products.newProduct': '+ Nuevo Producto',
    'products.noProducts': 'No hay productos disponibles',
    'products.publishedBy': 'Publicado por',
    'products.publishedOn': 'Publicado el',
    'products.description': 'Descripci√≥n',
    'products.contact': 'Contactar',
    'products.reserved': 'Reservado',
    'products.reservedByYou': 'Lo has reservado t√∫',
    'products.notReserved': 'No reservado',
    'products.unreserved': 'Desreservar',
    'products.favoritesCount': '{count} favoritos',
    'products.prestec': 'Pr√©stamo',
    'products.prestecTitle': 'Marcar como pr√©stamo',
    'products.unprestecTitle': 'Desmarcar como pr√©stamo',
    'products.reserve': 'Reservar',
    'products.deleteConfirm': '¬øEst√°s seguro de que quieres eliminar este producto?',
    'products.addToFavorites': 'A√±adir a favoritos',
    'products.removeFromFavorites': 'Eliminar de favoritos',
    'products.filters.name': 'Nombre del producto',
    'products.filters.user': 'Usuario',
    'products.filters.dateFrom': 'Fecha desde',
    'products.filters.dateTo': 'Fecha hasta',
    'products.filters.namePlaceholder': 'Buscar por nombre...',
    'products.filters.userPlaceholder': 'Buscar por usuario...',
    'products.filters.clearFilters': 'Borrar filtros',
    'products.filters.title': 'Filtros',
    'products.showing': 'Mostrando {filtered} de {total} productos',
    'products.noProductsPublished': 'A√∫n no hay productos publicados.',
    'products.beFirst': '¬°S√© el primero en publicar un producto!',
    'products.noResults': 'No se han encontrado productos con los filtros seleccionados.',
    'products.deleteProduct': 'Eliminar producto',
    'products.seeMoreDetails': 'Ver m√°s detalles',
    'products.reserveTitle': 'Reservar',
    'products.unreserveTitle': 'Desreservar',
    'favorites.title': 'Mis favoritos',
    'favorites.noFavorites': 'A√∫n no tienes ning√∫n producto en tus favoritos.',
    'favorites.explore': 'Explora productos ‚Üí',
    'myProducts.title': 'Mis productos',
    'myProducts.noProducts': 'A√∫n no has publicado ning√∫n producto.',
    'myProducts.publishFirst': 'Publica tu primer producto ‚Üí',
    'newProduct.title': 'Nuevo Producto',
    'newProduct.name': 'Nombre del producto *',
    'newProduct.namePlaceholder': 'Introduce el nombre del producto',
    'newProduct.description': 'Descripci√≥n',
    'newProduct.descriptionPlaceholder': 'Introduce una descripci√≥n del producto',
    'newProduct.images': 'Im√°genes (m√°ximo 4) *',
    'newProduct.maxImages': 'M√°ximo 4 im√°genes',
    'newProduct.upload': 'Subir imagen',
    'newProduct.create': 'Publicar Producto',
    'newProduct.publishing': 'Publicando...',
    'newProduct.nameRequired': 'El nombre del producto es obligatorio',
    'newProduct.addImage': 'A√±ade al menos una imagen',
    'newProduct.userNotAuth': 'Usuario no autenticado',
    'newProduct.createError': 'Error al crear el producto',
    'newProduct.connectionError': 'Error de conexi√≥n. Vuelve a intentarlo.',
    'productDetail.backToProducts': '‚Üê Volver a los productos',
    'productDetail.loading': 'Cargando...',
    'productDetail.notFound': 'Producto no encontrado',
    'productDetail.noImage': 'Sin imagen',
    'productDetail.reserved': 'Reservado',
    'productDetail.prestec': 'Pr√©stamo',
    'productDetail.description': 'Descripci√≥n',
    'productDetail.publishedBy': 'Publicado por',
    'productDetail.publishedOn': 'Publicado el',
    'productDetail.delete': 'Eliminar',
    'productDetail.contact': 'Contactar',
    'chat.general': 'üí¨ Chat General',
    'chat.privateWith': 'Chat con {nickname}',
    'chat.noMessages': 'No hay mensajes todav√≠a. ¬°S√© el primero en escribir!',
    'chat.writeMessage': 'Escribe un mensaje...',
    'chat.writePrivateMessage': 'Escribe un mensaje privado...',
    'chat.connecting': 'Conectando...',
    'chat.onlineUsers': 'Usuarios en l√≠nea',
    'chat.noOnlineUsers': 'No hay otros usuarios en l√≠nea',
    'chat.closeChat': 'Cerrar chat',
    'chat.startPrivateChat': 'Chat privado con {nickname}',
    'chat.send': 'Enviar',
    'chat.disabledProduction': '‚ö†Ô∏è El chat en tiempo real no est√° disponible en producci√≥n. Socket.io requiere configuraci√≥n adicional.',
    'chat.today': 'Hoy',
    'chat.yesterday': 'Ayer',
    'chat.dateSeparator': '{date}',
    'notifications.newMessage': 'Nuevo mensaje',
    'notifications.newPrivateMessage': 'Nuevo mensaje privado',
    'notifications.productReserved': 'Producto reservado',
    'notifications.productReservedMessage': '{nickname} ha reservado tu producto: {productName}',
    'notifications.productUnreserved': 'Producto desreservado',
    'notifications.productUnreservedMessage': '{nickname} ha desreservado tu producto: {productName}',
    'notifications.productUnreservedFromFavorites': 'Producto desreservado',
    'notifications.productUnreservedFromFavoritesMessage': '{nickname} ha desreservado un producto de tus favoritos: {productName}',
    'notifications.productDeletedFromFavorites': 'Producto eliminado',
    'notifications.productDeletedFromFavoritesMessage': '{nickname} ha eliminado un producto de tus favoritos: {productName}',
    'notifications.productAddedToFavorites': 'Producto a√±adido a favoritos',
    'notifications.productAddedToFavoritesMessage': '{nickname} ha a√±adido tu producto a favoritos: {productName}',
    'notifications.sessionTerminated': 'Sesi√≥n cerrada',
    'notifications.sessionTerminatedMessage': 'Se ha abierto una nueva sesi√≥n desde otro dispositivo.',
    'notifications.view': 'Ver',
    'notifications.enableNotifications': 'Activar notificaciones',
    'notifications.notificationsEnabled': 'Notificaciones activadas',
    'notifications.notificationsEnabledMessage': 'Ahora recibir√°s notificaciones del navegador.',
    'notifications.notificationsDisabled': 'Notificaciones desactivadas',
    'notifications.notificationsDisabledMessage': 'Has denegado los permisos de notificaci√≥n. Puedes activarlas desde la configuraci√≥n del navegador.',
    'notifications.enabled': 'Notificaciones activadas',
    'notifications.disableNotifications': 'Desactivar notificaciones',
    'notifications.disableInstructions': 'Desactivar notificaciones',
    'notifications.disableInstructionsMessage': 'Para desactivar las notificaciones, ve a la configuraci√≥n del navegador y bloquea los permisos de notificaci√≥n para este sitio web.',
    'notifications.preferencesTitle': 'Preferencias de notificaciones',
    'notifications.receiveAll': 'Recibir todas las notificaciones',
    'notifications.allowedUsersLabel': 'Usuarios permitidos',
    'notifications.allowedUsersHint': 'Nicknames separados por comas (ej: xavi, maria)',
    'notifications.allowedProductsLabel': 'Tipo de producto',
    'notifications.allowedProductsHint': 'Palabras clave separadas por comas (ej: bici, mesa)',
    'notifications.savePreferences': 'Guardar preferencias',
    'notifications.preferencesSaved': 'Preferencias guardadas',
    'notifications.preferencesError': 'No se han podido guardar las preferencias',
    'notifications.preferencesLoading': 'Cargando preferencias...',
  },
  en: {
    'common.appName': 'Xarxa Anglesola',
    'common.loading': 'Loading...',
    'common.error': 'Error',
    'common.save': 'Save',
    'common.cancel': 'Cancel',
    'common.delete': 'Delete',
    'common.edit': 'Edit',
    'common.send': 'Send',
    'common.close': 'Close',
    'common.next': 'Next',
    'common.back': 'Back',
    'common.translate': 'Translate',
      'auth.title': 'Xarxa Anglesola',
      'auth.subtitle': 'Product Exchange',
      'auth.nickname': 'Username',
      'auth.nicknamePlaceholder': 'Enter your username',
      'auth.password': 'Password',
      'auth.passwordPlaceholder': 'Enter your password',
      'auth.confirmPassword': 'Confirm password',
      'auth.confirmPasswordPlaceholder': 'Enter password again',
      'auth.email': 'Email',
      'auth.emailPlaceholder': 'Enter your email',
      'auth.newUser': 'I am a new user',
      'auth.register': 'Register',
      'auth.nicknameRequired': 'Username is required',
      'auth.passwordRequired': 'Password is required',
      'auth.confirmPasswordRequired': 'Password confirmation is required',
      'auth.emailRequired': 'Email is required',
      'auth.emailInvalid': 'Invalid email format',
      'auth.passwordsDoNotMatch': 'Passwords do not match',
      'auth.passwordMinLength': 'Password must be at least 6 characters',
      'auth.nicknameMinLength': 'Username must be at least 3 characters',
      'auth.error': 'Login error',
      'auth.connectionError': 'Connection error. Please try again.',
    'auth.enter': 'Enter',
    'auth.or': 'or',
    'auth.continueWithGoogle': 'Continue with Google',
    'auth.showPassword': 'Show password',
    'auth.hidePassword': 'Hide password',
      'auth.forgotPassword': 'Forgot password',
      'auth.forgotPasswordTitle': 'Recover password',
      'auth.forgotPasswordDescription': 'Enter your email and we will send you a link to reset your password.',
      'auth.forgotPasswordSuccess': 'If the email exists, a recovery link has been sent to your email.',
      'auth.forgotPasswordError': 'Error requesting password recovery',
      'auth.sendResetLink': 'Send link',
      'auth.resetPasswordTitle': 'Reset password',
      'auth.resetPasswordDescription': 'Enter your new password',
      'auth.newPassword': 'New password',
      'auth.resetPassword': 'Reset password',
      'auth.resetPasswordSuccess': 'Password reset successfully. Redirecting...',
      'auth.resetPasswordError': 'Error resetting password',
      'auth.invalidToken': 'Invalid or expired token. Request a new recovery link.',
      'auth.backToLogin': 'Back to login',
      'auth.redirectingToLogin': 'Redirecting to login...',
    'auth.accountNotLinked': 'You unlinked this Google account. Sign in with username and password.',
    'auth.acceptTerms': 'I accept the',
    'auth.privacyPolicy': 'Privacy Policy',
    'auth.and': 'and the',
    'auth.termsConditions': 'Terms and Conditions',
    'auth.mustAccept': 'You must accept the privacy policy and terms and conditions to register',
    'nav.products': 'Products',
    'nav.favorites': 'Favorites',
    'nav.myProducts': 'My Products',
    'nav.chat': 'General Chat',
    'nav.notifications': 'Alerts',
    'nav.noNotifications': 'No new alerts',
    'nav.hello': 'Hello, {nickname}!',
    'nav.logout': 'Logout',
    'nav.settings': 'Settings',
    'nav.openMenu': 'Open menu',
    'nav.closeMenu': 'Close menu',
    'info.title': 'How does the Xarxa work?',
    'info.intro': 'Xarxa Anglesola is a space to share and borrow things between parents of Anglesola school. Here\'s everything you can do:',
    'info.productsTitle': 'üì¶ Browse products',
    'info.productsDesc': 'Take a look at what people are sharing. Bikes, books, tools... whatever you need!',
    'info.favoritesTitle': '‚ù§Ô∏è Save to favourites',
    'info.favoritesDesc': 'See something you like? Add it to your favourites so you can find it later without losing it.',
    'info.myProductsTitle': '‚ú® Publish yours',
    'info.myProductsDesc': 'Got something you don\'t use? Publish it! Others can borrow it from you.',
    'info.reserveTitle': 'üìå Reserve',
    'info.reserveDesc': 'Something caught your eye? Reserve it and get in touch with the person who published it to arrange a handover.',
    'info.reserveMoreDetails': 'More details',
    'info.reserveDetailTitle': 'Types of reserve',
    'info.reserveDetailIntro': 'There are two ways to reserve a product on the Network:',
    'info.reserveType1Title': 'Reserve as the product owner',
    'info.reserveType1Desc': 'Tap the reserve button so it becomes unavailable for other reserves, and if it\'s a loan-only product you can change its status when needed.',
    'info.reserveType1DescBefore': 'Tap the ',
    'info.reserveType1DescAfter': ' button so it becomes unavailable for other reserves, and if it\'s a loan-only product you can change its status when needed.',
    'info.reserveType2Title': 'Reserve by DM',
    'info.reserveType2Desc': 'If you open the private chat for a product, you reserve it automatically (the first to open the chat gets the reserve). If the photo has a yellow frame, you reserved it; if it only has the yellow icon, someone else reserved it.',
    'info.chatTitle': 'üí¨ Chat',
    'info.chatDesc': 'Talk in the general chat or privately with someone who published a product. Great for coordinating handovers.',
    'info.notificationsTitle': 'üîî Notifications',
    'info.notificationsDesc': 'Turn on and customize alerts in the bell icon to know when someone reserves a product, messages you, or there\'s a change to your favourites.',
    'info.settingsTitle': '‚öôÔ∏è Settings',
    'info.settingsDesc': 'Manage your account, notification preferences, and your data from here.',
    'config.title': 'Settings',
    'config.account': 'Account',
    'config.unlinkGoogle': 'Unlink Google',
    'config.unlinkGoogleConfirm': 'Unlink your Google account? You will be logged out immediately. To log in again, use the form (register or login) or Continue with Google.',
    'config.unlinkGoogleSuccess': 'Google unlinked.',
    'config.unlinkGoogleError': 'Error unlinking Google.',
    'config.changeGoogle': 'Change Google account',
    'config.changeGoogleConfirm': 'You will be logged out and Google will open to choose another account. Continue?',
    'config.changeGoogleError': 'Error changing Google account.',
    'config.noGoogleLinked': 'You have no Google account linked.',
    'config.googleLinked': 'Google linked',
    'config.loading': 'Loading...',
    'config.version': 'Version',
    'products.title': 'Products',
    'products.newProduct': '+ New Product',
    'products.noProducts': 'No products available',
    'products.publishedBy': 'Published by',
    'products.publishedOn': 'Published on',
    'products.description': 'Description',
    'products.contact': 'Contact',
      'products.reserved': 'Reserved',
      'products.reservedByYou': 'You reserved it',
      'products.notReserved': 'Not reserved',
      'products.unreserved': 'Unreserve',
      'products.favoritesCount': '{count} favorites',
      'products.prestec': 'Loan',
      'products.prestecTitle': 'Mark as loan',
      'products.unprestecTitle': 'Unmark as loan',
    'products.reserve': 'Reserve',
    'products.deleteConfirm': 'Are you sure you want to delete this product?',
    'products.addToFavorites': 'Add to favorites',
    'products.removeFromFavorites': 'Remove from favorites',
    'products.filters.name': 'Product name',
    'products.filters.user': 'User',
    'products.filters.dateFrom': 'Date from',
    'products.filters.dateTo': 'Date to',
    'products.filters.namePlaceholder': 'Search by name...',
    'products.filters.userPlaceholder': 'Search by user...',
    'products.filters.clearFilters': 'Clear filters',
    'products.filters.title': 'Filters',
    'products.showing': 'Showing {filtered} of {total} products',
    'products.noProductsPublished': 'No products have been published yet.',
    'products.beFirst': 'Be the first to publish a product!',
    'products.noResults': 'No products found with the selected filters.',
    'products.deleteProduct': 'Delete product',
      'products.seeMoreDetails': 'See more details',
      'products.reserveTitle': 'Reserve',
      'products.unreserveTitle': 'Unreserve',
      'products.switchToGridView': 'Switch to grid view',
      'products.switchToListView': 'Switch to list view',
      'products.refresh': 'Refresh',
    'favorites.title': 'My Favorites',
    'favorites.noFavorites': "You don't have any products in your favorites yet.",
    'favorites.explore': 'Explore products ‚Üí',
    'myProducts.title': 'My Products',
    'myProducts.noProducts': "You haven't published any products yet.",
    'myProducts.publishFirst': 'Publish your first product ‚Üí',
    'newProduct.title': 'New Product',
    'newProduct.name': 'Product name *',
    'newProduct.namePlaceholder': 'Enter the product name',
    'newProduct.description': 'Description',
    'newProduct.descriptionPlaceholder': 'Enter a product description',
    'newProduct.images': 'Images (maximum 4) *',
    'newProduct.maxImages': 'Maximum 4 images',
    'newProduct.upload': 'Upload image',
    'newProduct.create': 'Publish Product',
    'newProduct.publishing': 'Publishing...',
    'newProduct.nameRequired': 'Product name is required',
    'newProduct.addImage': 'Add at least one image',
    'newProduct.userNotAuth': 'User not authenticated',
    'newProduct.createError': 'Error creating product',
    'newProduct.connectionError': 'Connection error. Please try again.',
    'productDetail.backToProducts': '‚Üê Back to products',
    'productDetail.loading': 'Loading...',
    'productDetail.notFound': 'Product not found',
    'productDetail.noImage': 'No image',
    'productDetail.reserved': 'Reserved',
    'productDetail.prestec': 'Loan',
    'productDetail.description': 'Description',
    'productDetail.publishedBy': 'Published by',
    'productDetail.publishedOn': 'Published on',
    'productDetail.delete': 'Delete',
    'productDetail.contact': 'Contact',
    'chat.general': 'üí¨ General Chat',
    'chat.privateWith': 'Chat with {nickname}',
    'chat.noMessages': 'No messages yet. Be the first to write!',
    'chat.writeMessage': 'Write a message...',
    'chat.writePrivateMessage': 'Write a private message...',
    'chat.connecting': 'Connecting...',
    'chat.onlineUsers': 'Online users',
    'chat.noOnlineUsers': 'No other users online',
    'chat.closeChat': 'Close chat',
    'chat.startPrivateChat': 'Private chat with {nickname}',
    'chat.send': 'Send',
    'chat.disabledProduction': '‚ö†Ô∏è Real-time chat is not available in production. Socket.io requires additional configuration.',
    'chat.today': 'Today',
    'chat.yesterday': 'Yesterday',
    'chat.dateSeparator': '{date}',
    'notifications.newMessage': 'New message',
    'notifications.newPrivateMessage': 'New private message',
    'notifications.productReserved': 'Product reserved',
    'notifications.productReservedMessage': '{nickname} reserved your product: {productName}',
    'notifications.productUnreserved': 'Product unreserved',
    'notifications.productUnreservedMessage': '{nickname} unreserved your product: {productName}',
    'notifications.productUnreservedFromFavorites': 'Product unreserved',
    'notifications.productUnreservedFromFavoritesMessage': '{nickname} unreserved a product in your favorites: {productName}',
    'notifications.productDeletedFromFavorites': 'Product deleted',
    'notifications.productDeletedFromFavoritesMessage': '{nickname} deleted a product in your favorites: {productName}',
    'notifications.productAddedToFavorites': 'Product added to favorites',
    'notifications.productAddedToFavoritesMessage': '{nickname} added your product to favorites: {productName}',
    'notifications.sessionTerminated': 'Session ended',
    'notifications.sessionTerminatedMessage': 'A new session was opened from another device.',
    'notifications.view': 'View',
    'notifications.enableNotifications': 'Enable notifications',
    'notifications.notificationsEnabled': 'Notifications enabled',
    'notifications.notificationsEnabledMessage': 'You will now receive browser notifications.',
    'notifications.notificationsDisabled': 'Notifications disabled',
    'notifications.notificationsDisabledMessage': 'You denied notification permissions. You can enable them in your browser settings.',
    'notifications.enabled': 'Notifications enabled',
    'notifications.disableNotifications': 'Disable notifications',
    'notifications.disableInstructions': 'Disable notifications',
    'notifications.disableInstructionsMessage': 'To disable notifications, go to your browser settings and block notification permissions for this site.',
    'notifications.preferencesTitle': 'Notification preferences',
    'notifications.receiveAll': 'Receive all notifications',
    'notifications.allowedUsersLabel': 'Allowed users',
    'notifications.allowedUsersHint': 'Nicknames separated by commas (e.g., xavi, maria)',
    'notifications.allowedProductsLabel': 'Product type',
    'notifications.allowedProductsHint': 'Keywords separated by commas (e.g., bike, table)',
    'notifications.savePreferences': 'Save preferences',
    'notifications.preferencesSaved': 'Preferences saved',
    'notifications.preferencesError': 'Unable to save preferences',
    'notifications.preferencesLoading': 'Loading preferences...',
    'config.gdpr.title': 'Data Protection (GDPR)',
    'config.gdpr.exportDescription': 'Download a copy of all your personal data in JSON format.',
    'config.gdpr.deleteDescription': 'Permanently delete your account and all your data. This action cannot be undone.',
    'legal.privacy.title': 'Privacy Policy',
    'legal.privacy.lastUpdated': 'Last updated',
    'legal.privacy.section1.title': '1. Introduction',
    'legal.privacy.section1.content': 'This Privacy Policy describes how we collect, use and protect your personal information when you use the Xarxa Anglesola platform. We are committed to protecting your privacy and complying with applicable data protection regulations.',
    'legal.privacy.section2.title': '2. Data we collect',
    'legal.privacy.section2.item1': 'Identification data: nickname, email, name (optional)',
    'legal.privacy.section2.item2': 'Authentication data: encrypted password, session tokens',
    'legal.privacy.section2.item3': 'Generated content: published products, chat messages, favorites list',
    'legal.privacy.section2.item4': 'Behavioral data: notification preferences, platform activity',
    'legal.privacy.section2.item5': 'Technical data: IP address, cookies, device information',
    'legal.privacy.section3.title': '3. Purpose of processing',
    'legal.privacy.section3.content': 'We use your data to: provide and improve our services, manage your account, facilitate communication between users, send relevant notifications, ensure platform security and comply with legal obligations.',
    'legal.privacy.section4.title': '4. Legal basis',
    'legal.privacy.section4.content': 'The processing of your data is based on: your consent, the execution of a contract (service provision), legitimate interest (security and service improvement) and compliance with legal obligations.',
    'legal.privacy.section5.title': '5. Your rights',
    'legal.privacy.section5.content': 'In accordance with the General Data Protection Regulation (GDPR), you have the right to:',
    'legal.privacy.section5.right1': 'Access: obtain a copy of your personal data',
    'legal.privacy.section5.right2': 'Rectification: correct inaccurate or incomplete data',
    'legal.privacy.section5.right3': 'Erasure: request the deletion of your data',
    'legal.privacy.section5.right4': 'Portability: receive your data in a structured format',
    'legal.privacy.section5.right5': 'Objection: object to the processing of your data under certain circumstances',
    'legal.privacy.section6.title': '6. Data retention',
    'legal.privacy.section6.content': 'We retain your data while your account is active and for the period necessary to comply with legal obligations. You can delete your account at any time from settings.',
    'legal.privacy.section7.title': '7. Security',
    'legal.privacy.section7.content': 'We implement technical and organizational security measures to protect your data against unauthorized access, loss or destruction. Passwords are stored encrypted and we use secure connections (HTTPS).',
    'legal.privacy.section8.title': '8. Contact',
    'legal.privacy.section8.content': 'To exercise your rights or make privacy inquiries, you can contact us through your account settings or using the data management features available on the platform.',
    'legal.terms.title': 'Terms and Conditions',
    'legal.terms.lastUpdated': 'Last updated',
    'legal.terms.section1.title': '1. Acceptance of terms',
    'legal.terms.section1.content': 'By using the Xarxa Anglesola platform, you accept these Terms and Conditions. If you do not agree, do not use the service.',
    'legal.terms.section2.title': '2. Use of the service',
    'legal.terms.section2.content': 'You agree to use the platform lawfully and respectfully. You may not use the service for illegal, fraudulent activities or activities that violate third-party rights.',
    'legal.terms.section3.title': '3. User content',
    'legal.terms.section3.content': 'You are responsible for the content you publish (products, messages, images). We reserve the right to moderate and remove content that we consider inappropriate, offensive or that violates these terms.',
    'legal.terms.section4.title': '4. Intellectual property',
    'legal.terms.section4.content': 'Users retain rights over the content they publish. By publishing content, you grant us a license to use it within the platform for service provision.',
    'legal.terms.section5.title': '5. Limitation of liability',
    'legal.terms.section5.content': 'The platform is provided "as is". We are not responsible for direct, indirect or consequential damages arising from the use of the service. Exchanges between users are the responsibility of users.',
    'legal.terms.section6.title': '6. Modifications',
    'legal.terms.section6.content': 'We reserve the right to modify these terms at any time. Modifications will take effect when published on the platform. Continued use of the service after modifications implies acceptance of the new terms.',
    'legal.terms.section7.title': '7. Dispute resolution',
    'legal.terms.section7.content': 'Any dispute related to the use of the platform will be governed by Spanish and Catalan legislation. Users agree to try to resolve conflicts amicably before resorting to legal actions.',
    'legal.cookies.message': 'This website uses cookies to improve user experience and provide essential functionality.',
    'legal.cookies.learnMore': 'Learn more',
    'legal.cookies.accept': 'Accept',
    'legal.cookies.reject': 'Reject',
    'legal.gdpr.exportData': 'Export data',
    'legal.gdpr.deleteAccount': 'Delete account',
    'legal.gdpr.exportSuccess': 'Your data has been exported successfully',
    'legal.gdpr.exportError': 'Error exporting data',
    'legal.gdpr.deleteConfirm': 'Are you sure you want to delete your account? This action cannot be undone.',
    'legal.gdpr.deleteSuccess': 'Your account has been deleted successfully',
    'legal.gdpr.deleteError': 'Error deleting account',
  },
}

const formatTranslation = (
  locale: Locale,
  key: string,
  params?: Record<string, string | number>
): string => {
  const translation = translations[locale][key] || key
  if (!params) {
    return translation
  }
  return Object.entries(params).reduce(
    (str, [paramKey, paramValue]) => str.replace(`{${paramKey}}`, String(paramValue)),
    translation
  )
}

export function I18nProvider({ children }: { children: ReactNode }) {
  const [locale, setLocaleState] = useState<Locale>('ca')

  useEffect(() => {
    const savedLocale = localStorage.getItem('locale') as Locale
    if (savedLocale && (savedLocale === 'ca' || savedLocale === 'es' || savedLocale === 'en')) {
      setLocaleState(savedLocale)
    }
  }, [])

  const setLocale = (newLocale: Locale) => {
    setLocaleState(newLocale)
    localStorage.setItem('locale', newLocale)
  }

  const t = (key: string, params?: Record<string, string | number>): string =>
    formatTranslation(locale, key, params)

  const translateText = async (text: string, targetLocale?: Locale): Promise<string> => {
    const target = targetLocale || locale
    
    try {
      // Sense detecci√≥ d'idioma per evitar problemes amb franc en producci√≥
      // Assumir que el text est√† en un idioma diferent al target
      const sourceLang = target === 'ca' ? 'es' : 'ca' // Alternativa simple
      
      // Mapejar els codis d'idioma de l'app als que espera l'API
      const localeMap: Record<Locale, string> = {
        'ca': 'ca',
        'es': 'es',
        'en': 'en'
      }
      
      const targetLang = localeMap[target]
      
      // Si l'idioma detectat ja √©s el mateix que l'objectiu, retornar el text sense canvis
      if (sourceLang === targetLang) {
        return text
      }
      
      // Usar l'API gratu√Øta de MyMemory Translation amb l'idioma detectat
      const response = await fetch(
        `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${sourceLang}|${targetLang}`
      )
      const data = await response.json()
      if (data.responseData && data.responseData.translatedText) {
        return data.responseData.translatedText
      }
      return text
    } catch (error) {
      logError('Error translating text:', error)
      return text
    }
  }

  return (
    <I18nContext.Provider value={{ locale, setLocale, t, translateText }}>
      {children}
    </I18nContext.Provider>
  )
}

export function useI18n() {
  const context = useContext(I18nContext)
  if (!context) {
    if (process.env.NODE_ENV !== 'production') {
      logWarn('useI18n must be used within I18nProvider')
    }
    return {
      locale: 'ca' as Locale,
      setLocale: () => {},
      t: (key: string, params?: Record<string, string | number>) =>
        formatTranslation('ca', key, params),
      translateText: async (text: string) => text,
    }
  }
  return context
}

